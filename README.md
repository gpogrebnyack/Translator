# üìö EPUB Book Translator

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –∫–Ω–∏–≥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ EPUB —Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI (OpenRouter API).

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ EPUB —Ñ–∞–π–ª–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª–æ—Å—Å–∞—Ä–∏—è —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ –∏–º—ë–Ω
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥–∞–π–¥–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
- ‚úÖ AI-–ø–µ—Ä–µ–≤–æ–¥ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ checkpoint –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–æ–≥–æ JSON –æ–±—Ä–∞—Ç–Ω–æ –≤ EPUB
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–Ω–∏–≥ —Å —á–∞—Å—Ç—è–º–∏ (parts) –∏ –±–µ–∑ –Ω–∏—Ö

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- OpenRouter API –∫–ª—é—á ([–ø–æ–ª—É—á–∏—Ç—å –∑–¥–µ—Å—å](https://openrouter.ai/))

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone <repository-url>
cd translator-optimized
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
pip install -r requirements.txt
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
# OpenRouter API Configuration
OPENROUTER_API_KEY=your-api-key-here

# OpenRouter Model Configuration
OPENROUTER_MODEL=google/gemini-3-pro-preview
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `config.json`:

```json
{
  "book": "YourBookName",
  "paths": {
    "input_dir": "__IN",
    "output_dir": "__OUT",
    "epub_file": "YourBook.epub",
    "cover_image": "__OUT/YourBookName/cover.jpg"
  },
  "settings": {
    "glossary_max_chars": 500000,
    "translation_max_tokens": 5000,
    "translation_context": 10
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

- **`book`** - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤)
- **`paths.input_dir`** - –ø–∞–ø–∫–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ EPUB —Ñ–∞–π–ª–∞–º–∏
- **`paths.output_dir`** - –ø–∞–ø–∫–∞ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **`paths.epub_file`** - –∏–º—è EPUB —Ñ–∞–π–ª–∞ –≤ `input_dir`
- **`paths.cover_image`** - –ø—É—Ç—å –∫ –æ–±–ª–æ–∂–∫–µ –∫–Ω–∏–≥–∏
- **`settings.glossary_max_chars`** - –º–∞–∫—Å–∏–º—É–º —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥–ª–æ—Å—Å–∞—Ä–∏—è
- **`settings.translation_max_tokens`** - —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ (—Ç–æ–∫–µ–Ω—ã)
- **`settings.translation_context`** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
translator-optimized/
‚îú‚îÄ‚îÄ 0_epub_to_json(optimized).py      # –ü–∞—Ä—Å–µ—Ä EPUB ‚Üí JSON
‚îú‚îÄ‚îÄ 1_glossary_and_styleguide.py      # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≥–ª–æ—Å—Å–∞—Ä–∏—è –∏ —Å—Ç–∏–ª–µ–≥–∞–π–¥–∞
‚îú‚îÄ‚îÄ 2_translate_book(optimized).py    # –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ –∫–Ω–∏–≥–∏
‚îú‚îÄ‚îÄ 3_json_to_epub(optimized).py      # –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä JSON ‚Üí EPUB
‚îú‚îÄ‚îÄ config_helper.py                  # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ config.json                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env                              # API –∫–ª—é—á–∏ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)
‚îú‚îÄ‚îÄ requirements.txt                  # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ __IN/                             # –í—Ö–æ–¥–Ω—ã–µ EPUB —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ YourBook.epub
‚îî‚îÄ‚îÄ __OUT/                            # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã
    ‚îî‚îÄ‚îÄ YourBookName/
        ‚îú‚îÄ‚îÄ YourBookName.json         # –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–∞—è –∫–Ω–∏–≥–∞
        ‚îú‚îÄ‚îÄ YourBookName_glossary.json
        ‚îú‚îÄ‚îÄ YourBookName_styleguide.md
        ‚îú‚îÄ‚îÄ YourBookName_ru.json      # –ü–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–∞—è –∫–Ω–∏–≥–∞
        ‚îú‚îÄ‚îÄ YourBookName_ru.epub      # –§–∏–Ω–∞–ª—å–Ω—ã–π EPUB
        ‚îú‚îÄ‚îÄ cover.jpg
        ‚îî‚îÄ‚îÄ translation_checkpoint.json
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–≤–æ–¥–∞

### –®–∞–≥ 1: –ü–∞—Ä—Å–∏–Ω–≥ EPUB –≤ JSON

```bash
python 0_epub_to_json\(optimized\).py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä, —è–∑—ã–∫)
- –ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–Ω–∏–≥–∏ (—á–∞—Å—Ç–∏, –≥–ª–∞–≤—ã)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `__OUT/YourBookName/YourBookName.json`

### –®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª–æ—Å—Å–∞—Ä–∏—è –∏ —Å—Ç–∏–ª–µ–≥–∞–π–¥–∞

```bash
python 1_glossary_and_styleguide.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∫–Ω–∏–≥–∏ (–¥–æ 500,000 —Å–∏–º–≤–æ–ª–æ–≤)
- –°–æ–∑–¥–∞—ë—Ç –≥–ª–æ—Å—Å–∞—Ä–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –º–µ—Å—Ç, —Ç–µ—Ä–º–∏–Ω–æ–≤
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –≥–∞–π–¥ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- `__OUT/YourBookName/YourBookName_glossary.json`
- `__OUT/YourBookName/YourBookName_styleguide.md`

### –®–∞–≥ 3: –ü–µ—Ä–µ–≤–æ–¥ –∫–Ω–∏–≥–∏

```bash
python 2_translate_book\(optimized\).py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä)
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Å—Ç–µ–π –∏ –≥–ª–∞–≤
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–ª–æ—Å—Å–∞—Ä–∏—è –∏ —Å—Ç–∏–ª–µ–≥–∞–π–¥–∞
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ checkpoint —Ñ–∞–π–ª
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `__OUT/YourBookName/YourBookName_ru.json`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω—ã—Ö –≥–ª–∞–≤ –Ω–∞ –±–∞—Ç—á–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –¥–ª—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏
- Retry –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ EPUB

```bash
python 3_json_to_epub\(optimized\).py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞—ë—Ç EPUB —Ñ–∞–π–ª –∏–∑ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–æ–≥–æ JSON
- –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±–ª–æ–∂–∫—É
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —Å CSS —Å—Ç–∏–ª—è–º–∏
- –°–æ–∑–¥–∞—ë—Ç –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ (TOC)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `__OUT/YourBookName_ru.epub`

## üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏

### `config_helper.py`

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª–∞—Å—Å `ConfigPaths` –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏:

```python
from config_helper import get_paths

paths = get_paths()
print(paths.epub_source)      # –ü—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É EPUB
print(paths.output_json)       # –ü—É—Ç—å –∫ JSON
print(paths.glossary_json)     # –ü—É—Ç—å –∫ –≥–ª–æ—Å—Å–∞—Ä–∏—é
print(paths.translated_json)   # –ü—É—Ç—å –∫ –ø–µ—Ä–µ–≤–æ–¥—É
print(paths.output_epub)       # –ü—É—Ç—å –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É EPUB
```

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —á–∞—Å—Ç—è–º–∏ (Parts):
```json
{
  "book_id": "book_name",
  "metadata": {...},
  "parts": [
    {
      "part_number": 1,
      "part_title": "Part I: Title",
      "blockquote": {"text": "...", "author": "..."},
      "chapters": [...]
    }
  ]
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ —á–∞—Å—Ç–µ–π (Flat):
```json
{
  "book_id": "book_name",
  "metadata": {...},
  "chapters": [
    {
      "chapter_id": "ch1",
      "title": "Chapter 1",
      "content": "...",
      "word_count": 1234
    }
  ]
}
```

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–î–ª—è –±–æ–ª—å—à–∏—Ö –∫–Ω–∏–≥:** –£–≤–µ–ª–∏—á—å—Ç–µ `translation_max_tokens` –¥–æ 8000-10000
2. **–î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª—å `google/gemini-3-pro-preview`
3. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö API:** –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—Å—è —Å checkpoint
4. **–≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤:** –£–º–µ–Ω—å—à–∏—Ç–µ `glossary_max_chars` –¥–æ 300000

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "OPENROUTER_API_KEY not found"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

### –û—à–∏–±–∫–∞: "File not found: config.json"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞.

### –ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–µ—Ä–≤–∞–Ω
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞ - –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint.

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É `translation_max_tokens` - —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–∑–±–∏–≤–∞—Ç—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã.

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù –í–∫–ª–∞–¥

Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ issue –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è.

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
